#!/bin/sh
ip=$(cat $HOME/.scripts/.env/ip-proxmox-server)
active=$(ping -c 1 "$ip" | grep -Po "[0-9]+(?=%)" )

# Checks if server is up if not starts it
start_server() {
	echo "Checking if the server is up"
	notify-send "windows-server" "Checking if the server is up"
	if [ $active -eq 100 ]; then
		/usr/bin/dash $HOME/.scripts/start-server
	else
		echo "Server already up"
		notify-send "windows-server" "Server already up"
	fi
}

connect_to_vm() {
	echo "Connecting to the VM"
	notify-send "windows-server"  "Connecting to the VM"
	sleep 4
	remmina $HOME/.local/share/remmina/group_rdp_eureciclo-windows-vm_192-168-1-136.remmina
}

start_server
start-vm.sh 103 windows-server
connect_to_vm
exit 0
